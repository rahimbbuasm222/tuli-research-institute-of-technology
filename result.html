<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Official Result Archive - Tuli Research Institute</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #e9ecef; margin: 0; }
        
        /* ‡¶Æ‡ßá‡¶®‡ßÅ‡¶¨‡¶æ‡¶∞ (‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶•‡¶æ‡¶ï‡¶¨‡ßá) */
        nav { background: #006a4e; padding: 15px; text-align: center; }
        nav a { color: white; text-decoration: none; margin: 0 15px; font-weight: bold; }

        /* ‡¶Æ‡ßá‡¶á‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞ */
        .container { max-width: 900px; margin: 30px auto; background: white; padding: 40px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }

        /* ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶¨‡¶ï‡ßç‡¶∏ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        .search-box { text-align: center; margin-bottom: 30px; padding: 20px; background: #f1f8e9; border: 1px solid #c5e1a5; border-radius: 5px; }
        select, input, button { padding: 10px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { background: #006a4e; color: white; cursor: pointer; border: none; font-weight: bold; }

        /* ==============================
           OFFICIAL MARKSHEET DESIGN
           ============================== */
        #result-sheet {
            display: none; /* ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã */
            border: 5px double #006a4e;
            padding: 30px;
            position: relative;
            background: white;
        }

        /* ‡¶ì‡ßü‡¶æ‡¶ü‡¶æ‡¶∞‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï (Watermark) */
        #result-sheet::before {
            content: "";
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Government_Seal_of_Bangladesh.svg/1200px-Government_Seal_of_Bangladesh.svg.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 300px;
            opacity: 0.05;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
        }

        /* ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid black; padding-bottom: 20px; margin-bottom: 20px; position: relative; z-index: 1; }
        .logo { width: 80px; height: auto; }
        .board-info { text-align: center; }
        .board-info h2 { margin: 0; color: #006a4e; font-size: 24px; text-transform: uppercase; }
        .board-info h3 { margin: 5px 0; font-size: 18px; color: #333; }
        .exam-title { background: #006a4e; color: white; padding: 5px 20px; border-radius: 20px; font-size: 14px; font-weight: bold; display: inline-block; margin-top: 10px; }

        /* ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡ßá‡¶®‡ßç‡¶ü ‡¶á‡¶®‡¶´‡ßã ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ */
        .student-info { width: 100%; border-collapse: collapse; margin-bottom: 20px; position: relative; z-index: 1; }
        .student-info td { padding: 8px; border: 1px solid #ddd; font-size: 14px; }
        .student-info .label { font-weight: bold; background: #f9f9f9; width: 20%; }

        /* ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶∏ ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ */
        .marks-table { width: 100%; border-collapse: collapse; margin-top: 10px; position: relative; z-index: 1; }
        .marks-table th { background: #eee; border: 1px solid #333; padding: 8px; font-size: 14px; }
        .marks-table td { border: 1px solid #333; padding: 8px; text-align: center; font-size: 14px; }
        .marks-table td.sub-name { text-align: left; padding-left: 15px; }

        /* ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ / ‡¶∏‡¶ø‡¶ó‡¶®‡ßá‡¶ö‡¶æ‡¶∞ */
        .footer { margin-top: 50px; display: flex; justify-content: space-between; position: relative; z-index: 1; }
        .signature { text-align: center; border-top: 1px dashed black; width: 200px; padding-top: 5px; }

        /* ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® */
        .print-btn-area { text-align: center; margin-top: 20px; }
        .print-btn { background: #d35400; padding: 10px 30px; font-size: 16px; }

        /* ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶Ø‡¶æ ‡¶π‡¶¨‡ßá */
        @media print {
            nav, .search-box, .print-btn-area { display: none; }
            .container { box-shadow: none; margin: 0; padding: 0; max-width: 100%; }
            #result-sheet { display: block !important; border: none; }
        }
    </style>
</head>
<body>

    <nav>
        <a href="/">‡¶π‡ßã‡¶Æ</a>
        <a href="/result">‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶Ü‡¶∞‡ßç‡¶ï‡¶æ‡¶á‡¶≠</a>
        <a href="/admin">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶ø‡¶®</a>
    </nav>

    <div class="container">
        <!-- ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div class="search-box">
            <h3 style="color:#006a4e; margin-top:0;">üìÇ ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶Ö‡¶®‡ßÅ‡¶∏‡¶®‡ßç‡¶ß‡¶æ‡¶®</h3>
            
            <select id="examName">
                <option value="">‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                <option value="DUMS 1st Year">DUMS 1st Year</option>
                <option value="DUMS Final">DUMS Final</option>
                <option value="DAMS 1st Year">DAMS 1st Year</option>
                <option value="DAMS Final">DAMS Final</option>
                <option value="SSC">SSC</option>
                <option value="HSC">HSC</option>
            </select>

            <select id="year"><option value="2025">2025</option></select>
            <input type="text" id="roll" placeholder="‡¶∞‡ßã‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" required>
            <button onclick="searchResult()">‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        </div>

        <!-- ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶∂‡¶ø‡¶ü ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® -->
        <div id="result-sheet">
            
            <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
            <div class="header">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Government_Seal_of_Bangladesh.svg/1200px-Government_Seal_of_Bangladesh.svg.png" class="logo" alt="Govt Logo">
                
                <div class="board-info">
                    <h2>Bangladesh Board of Unani and Ayurvedic Systems of Medicine</h2>
                    <h3>Tuli Research Institute of Technology</h3>
                    <div class="exam-title">ACADEMIC TRANSCRIPT / MARKSHEET</div>
                </div>

                <!-- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶≤‡ßã‡¶ó‡ßã -->
                <img src="/images/logo.jpg" class="logo" alt="Institute Logo" onerror="this.style.display='none'">
            </div>

            <!-- ‡¶õ‡¶æ‡¶§‡ßç‡¶∞‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø -->
            <table class="student-info">
                <tr>
                    <td class="label">Student's Name</td> <td id="res-name"></td>
                    <td class="label">Roll No</td> <td id="res-roll"></td>
                </tr>
                <tr>
                    <td class="label">Father's Name</td> <td id="res-father"></td>
                    <td class="label">Reg No</td> <td id="res-reg"></td>
                </tr>
                <tr>
                    <td class="label">Mother's Name</td> <td id="res-mother"></td>
                    <td class="label">Session</td> <td>2024-2025</td>
                </tr>
                <tr>
                    <td class="label">Institute</td> <td id="res-inst" colspan="3"></td>
                </tr>
                <tr>
                    <td class="label">Exam Name</td> <td id="res-exam"></td>
                    <td class="label">Result</td> <td id="res-gpa" style="font-weight:bold;"></td>
                </tr>
            </table>

            <!-- ‡¶¨‡¶ø‡¶∑‡ßü‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü -->
            <table class="marks-table">
                <thead>
                    <tr>
                        <th style="width: 10%;">Sl. No.</th>
                        <th style="width: 50%;">Name of Subjects</th>
                        <th style="width: 20%;">Letter Grade</th>
                        <th style="width: 20%;">Grade Point</th>
                    </tr>
                </thead>
                <tbody id="marks-body">
                    <!-- JS ‡¶¶‡¶ø‡ßü‡ßá ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶∏ ‡¶¨‡¶∏‡¶¨‡ßá -->
                </tbody>
            </table>

            <!-- ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ -->
            <div class="footer">
                <div style="font-size: 12px;">
                    Date of Publication: <span id="pub-date"></span><br>
                    Generated by: Tuli Research Automation System
                </div>
                <div class="signature">
                    <strong>Controller of Examinations</strong><br>
                    Bangladesh Unani & Ayurvedic Board
                </div>
            </div>

        </div>

        <div class="print-btn-area" id="print-area" style="display:none;">
            <button class="print-btn" onclick="window.print()">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü / ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
        </div>
    </div>

    <script>
        async function searchResult() {
            const roll = document.getElementById('roll').value;
            const examName = document.getElementById('examName').value;

            if(!roll || !examName) { alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∞‡ßã‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); return; }

            try {
                const res = await fetch(`/api/results/search?roll=${roll}&examName=${examName}`);
                const data = await res.json();

                if (data.found) {
                    const info = data.data;
                    document.getElementById('result-sheet').style.display = 'block';
                    document.getElementById('print-area').style.display = 'block';
                    
                    // ‡¶§‡¶•‡ßç‡¶Ø ‡¶¨‡¶∏‡¶æ‡¶®‡ßã
                    document.getElementById('res-name').innerText = info.studentName;
                    document.getElementById('res-father').innerText = info.fatherName || "-";
                    document.getElementById('res-mother').innerText = info.motherName || "-";
                    document.getElementById('res-roll').innerText = info.roll;
                    document.getElementById('res-reg').innerText = info.regNo || "-";
                    document.getElementById('res-inst').innerText = info.institute || "Tuli Research Institute";
                    document.getElementById('res-exam').innerText = info.examName + " - " + info.year;
                    
                    // ‡¶∞‡ßá‡¶ú‡¶æ‡¶≤‡ßç‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ì ‡¶ú‡¶ø‡¶™‡¶ø‡¶è
                    let resultText = "";
                    if(info.resultStatus === 'FAILED') {
                        resultText = `FAILED`;
                        document.getElementById('res-gpa').style.color = 'red';
                    } else {
                        resultText = `PASSED (GPA: ${info.gpa})`;
                        document.getElementById('res-gpa').style.color = 'green';
                    }
                    document.getElementById('res-gpa').innerText = resultText;

                    // ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ
                    const today = new Date();
                    document.getElementById('pub-date').innerText = today.toLocaleDateString('en-GB');

                    // ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡¶∂‡¶ø‡¶ü ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø
                    const marksBody = document.getElementById('marks-body');
                    marksBody.innerHTML = '';

                    if (info.marks && info.marks.length > 0) {
                        info.marks.forEach((sub, index) => {
                            const row = `<tr>
                                <td>${index + 1}</td>
                                <td class="sub-name">${sub.subject}</td>
                                <td>${sub.grade}</td>
                                <td>${sub.point}</td>
                            </tr>`;
                            marksBody.innerHTML += row;
                        });
                        
                        // ‡¶´‡¶æ‡¶á‡¶®‡¶æ‡¶≤ ‡¶ú‡¶ø‡¶™‡¶ø‡¶è ‡¶∞‡ßã
                        const totalRow = `<tr style="background:#f0f0f0; font-weight:bold;">
                            <td colspan="3" style="text-align:right; padding-right:15px;">GPA (Grade Point Average)</td>
                            <td>${info.gpa}</td>
                        </tr>`;
                        marksBody.innerHTML += totalRow;

                    } else {
                        marksBody.innerHTML = '<tr><td colspan="4" style="color:red;">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</td></tr>';
                    }

                } else {
                    document.getElementById('result-sheet').style.display = 'none';
                    document.getElementById('print-area').style.display = 'none';
                    alert("‚ùå ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§! ‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§");
                }
            } catch (err) {
                console.error(err);
                alert("‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶™‡¶∞‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            }
        }
    </script>
</body>
</html>